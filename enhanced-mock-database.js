// å¼·åŒ–ç‰ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ - å®Ÿéš›ã®ç…§åˆæ¥­å‹™ãƒ•ãƒ­ãƒ¼å¯¾å¿œ
class EnhancedMockDatabase {
    constructor() {
        // åŸºæœ¬æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿
        this.projects = [
            {
                ç‰©ä»¶No: '37.04.001',
                ç‰©ä»¶å: 'ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ³ã‚·ãƒ§ãƒ³101',
                é¡§å®¢å: 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«',
                æ‹…å½“è€…: 'å²¡ç”°',
                å·¥äº‹åŒºåˆ†: 'ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³',
                å¥‘ç´„é¡: 5000000,
                è¦‹ç©åŸä¾¡: 3500000,
                åˆ©ç›Šé¡: 1500000,
                åˆ©ç›Šç‡: 30.0,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'å®Œäº†',
                è«‹æ±‚æ—¥: new Date('2024-04-30'),
                å…¥é‡‘æ—¥: new Date('2024-05-30'),
                è«‹æ±‚é¡: 5000000,
                å…¥é‡‘é¡: 5000000
            },
            {
                ç‰©ä»¶No: '37.04.002',
                ç‰©ä»¶å: 'ãƒ†ã‚¹ãƒˆãƒ“ãƒ«3F',
                é¡§å®¢å: 'æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆ',
                æ‹…å½“è€…: 'ç”°åŸ',
                å·¥äº‹åŒºåˆ†: 'åŸçŠ¶å›å¾©',
                å¥‘ç´„é¡: 1200000,
                è¦‹ç©åŸä¾¡: 950000,
                åˆ©ç›Šé¡: 250000,
                åˆ©ç›Šç‡: 20.8,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'é€²è¡Œä¸­',
                è«‹æ±‚æ—¥: new Date('2024-04-30'),
                å…¥é‡‘æ—¥: null,
                è«‹æ±‚é¡: 1200000,
                å…¥é‡‘é¡: 0
            },
            // æ¡ˆä»¶ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç…§åˆã‚µãƒãƒªãƒ¼ç”¨ï¼‰
            {
                ç‰©ä»¶No: '37.07.133',
                ç‰©ä»¶å: 'ãƒ‘ãƒ¬ã‚¹ä»£ã€…æœ¨ã€€201å·å®¤',
                é¡§å®¢å: 'èˆˆå’Œç®¡ç†(æ ª)',
                æ‹…å½“è€…: 'è—¤å²¡',
                å¥‘ç´„é¡: 156500,
                åŸä¾¡é‡‘é¡: 125200,
                åˆ©ç›Šç‡: 20.0,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'å®Œäº†',
                ç™ºæ³¨æ—¥: '2025/06/13',
                å®Œäº†äºˆå®šæ—¥: '2025/07/08'
            },
            {
                ç‰©ä»¶No: '37.06.124',
                ç‰©ä»¶å: 'ã‚µãƒ³ã‚¢ã‚»ãƒ³ãƒˆã€€301å·å®¤',
                é¡§å®¢å: 'ã‚¢ãƒ—ãƒ­ãƒ›ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ã‚¹(æ ª)',
                æ‹…å½“è€…: 'è—¤å²¡',
                å¥‘ç´„é¡: 172000,
                åŸä¾¡é‡‘é¡: 146400,
                åˆ©ç›Šç‡: 14.9,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç…§åˆå¾…ã¡',
                ç™ºæ³¨æ—¥: '2025/06/11',
                å®Œäº†äºˆå®šæ—¥: '2025/06/28'
            },
            {
                ç‰©ä»¶No: '37.06.120',
                ç‰©ä»¶å: 'ä¸­å¤–åŒ»å­¦ç¤¾ã€€å¥³å­ãƒˆã‚¤ãƒ¬',
                é¡§å®¢å: 'æ ªå¼ä¼šç¤¾æ±å…ƒç¤¾',
                æ‹…å½“è€…: 'è—¤å²¡',
                å¥‘ç´„é¡: 85000,
                åŸä¾¡é‡‘é¡: 72250,
                åˆ©ç›Šç‡: 15.0,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'é€²è¡Œä¸­',
                ç™ºæ³¨æ—¥: '2025/06/20',
                å®Œäº†äºˆå®šæ—¥: '2025/06/27'
            },
            {
                ç‰©ä»¶No: '37.06.115',
                ç‰©ä»¶å: 'æ—¥èˆˆãƒ‘ãƒ¬ã‚¹æ°¸ä»£ã€€803å·å®¤',
                é¡§å®¢å: 'èˆˆå’Œç®¡ç†(æ ª)',
                æ‹…å½“è€…: 'è—¤å²¡',
                å¥‘ç´„é¡: 35000,
                åŸä¾¡é‡‘é¡: 31500,
                åˆ©ç›Šç‡: 10.0,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç…§åˆå¾…ã¡',
                ç™ºæ³¨æ—¥: '2025/06/19',
                å®Œäº†äºˆå®šæ—¥: '2025/06/28'
            },
            {
                ç‰©ä»¶No: '37.06.110',
                ç‰©ä»¶å: 'ãƒ”ã‚¢ãƒã‚¦ã‚¹201',
                é¡§å®¢å: '(æ ª)ã‚¦ã‚£ãƒ³ã‚°ã‚¹ã‚¸ãƒ£ãƒ‘ãƒ³',
                æ‹…å½“è€…: 'è—¤å²¡',
                å¥‘ç´„é¡: 42000,
                åŸä¾¡é‡‘é¡: 33600,
                åˆ©ç›Šç‡: 20.0,
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'å®Œäº†',
                ç™ºæ³¨æ—¥: '2025/06/19',
                å®Œäº†äºˆå®šæ—¥: '2025/07/05'
            }
        ];

        // è¦‹ç©ã‚‚ã‚Šè©³ç´°ï¼ˆææ–™åˆ¥ï¼‰
        this.estimates = [
            {
                ID: 1,
                ç‰©ä»¶No: '37.04.001',
                ã‚«ãƒ†ã‚´ãƒª: 'ææ–™',
                å“ç›®: 'ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒƒãƒãƒ³',
                ãƒ¡ãƒ¼ã‚«ãƒ¼: 'ãƒ‘ãƒŠã‚½ãƒ‹ãƒƒã‚¯',
                å‹ç•ª: 'Lacucina',
                è¦‹ç©åŸä¾¡: 780000,
                å‚™è€ƒ: 'æ¨™æº–ä»•æ§˜'
            },
            {
                ID: 2,
                ç‰©ä»¶No: '37.04.001',
                ã‚«ãƒ†ã‚´ãƒª: 'ææ–™',
                å“ç›®: 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹',
                ãƒ¡ãƒ¼ã‚«ãƒ¼: 'TOTO',
                å‹ç•ª: 'WBV1616',
                è¦‹ç©åŸä¾¡: 650000,
                å‚™è€ƒ: '1616ã‚µã‚¤ã‚º'
            },
            {
                ID: 3,
                ç‰©ä»¶No: '37.04.001',
                ã‚«ãƒ†ã‚´ãƒª: 'å·¥äº‹',
                å“ç›®: 'å†…è£…å·¥äº‹',
                æ¥­è€…: 'å†…è£…å·¥äº‹æ ªå¼ä¼šç¤¾',
                è¦‹ç©åŸä¾¡: 500000,
                å‚™è€ƒ: 'å…¨é¢ãƒªãƒ•ã‚©ãƒ¼ãƒ '
            }
        ];

        // å®Ÿéš›ã®å·¥äº‹æ³¨æ–‡æ›¸ãƒ‡ãƒ¼ã‚¿ï¼ˆæä¾›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼‰
        this.workOrders = [
            {
                ç™ºæ³¨æ—¥ä»˜: '2025/06/20',
                ä¼ç¥¨ç•ªå·: '267934',
                ç™ºæ³¨å…ˆå: '(æ ª)ã‚¢ãƒ³ã‚»ã‚¤',
                å·¥äº‹å ´æ‰€: 'æ–°å®¿åŒºçŸ¢æ¥ç”º62',
                å—æ³¨å…ˆ: 'æ ªå¼ä¼šç¤¾æ±å…ƒç¤¾',
                ç‰©ä»¶å: 'ä¸­å¤–åŒ»å­¦ç¤¾ã€€å¥³å­ãƒˆã‚¤ãƒ¬',
                æ‹…å½“è€…: 'è—¤å²¡',
                æ–½å·¥é–‹å§‹æ—¥: '2025/6/23',
                æ–½å·¥çµ‚äº†æ—¥: '2025/06/27',
                ã‚«ã‚®: 'æ ªå¼ä¼šç¤¾ ä¸­å¤–åŒ»å­¦ç¤¾ã€€é’æœ¨æ§˜080-2143-5153',
                ç™ºæ³¨é‡‘é¡: 0,
                è©³ç´°æ˜ç´°: [
                    { No: 10, æ˜ç´°: 'ä»¥ä¸‹ã€ç™ºæ³¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚', é‡‘é¡: 0 },
                    { No: 20, æ˜ç´°: 'ææ–™ç¾å ´ç´å“ã€€ã‚´ãƒŸã¯ãƒ‹ãƒƒã‚½ã‚¦ã¸', é‡‘é¡: 0 }
                ]
            },
            {
                ç™ºæ³¨æ—¥ä»˜: '2025/06/20',
                ä¼ç¥¨ç•ªå·: '267926',
                ç™ºæ³¨å…ˆå: '(åŒ)æ‘ä¸Šå¡—è£…ã€€ã€€ã€€2022/1/26ï½æ–°ä¼šç¤¾è¨­ç«‹',
                å·¥äº‹å ´æ‰€: 'ä¸–ç”°è°·åŒºä¸­ç”º2-38-9',
                å—æ³¨å…ˆ: 'é½‹è—¤å…¬æ˜æ§˜ã€€ç£¯éƒ¨æ·±é›ªæ§˜',
                ç‰©ä»¶å: 'æ–è—¤æ§˜é‚¸ã€€B1ã€€å£é¢éƒ¨åˆ†å¡—è£…',
                æ‹…å½“è€…: 'è—¤å²¡',
                æ–½å·¥é–‹å§‹æ—¥: '2025/7/15',
                æ–½å·¥çµ‚äº†æ—¥: '2025/06/16',
                ã‚«ã‚®: 'B1ã€€ã®ãƒã‚¹ãƒˆã®ä¸­ã«éµ',
                ç™ºæ³¨é‡‘é¡: 38000,
                è©³ç´°æ˜ç´°: [
                    { No: 10, æ˜ç´°: 'ä»¥ä¸‹ã€ç™ºæ³¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚', é‡‘é¡: 0 },
                    { No: 20, æ˜ç´°: 'ææ–™ç¾å ´ç´å“ã€€ã‚´ãƒŸã¯ãƒ‹ãƒƒã‚½ã‚¦ã¸', é‡‘é¡: 0 },
                    { No: 30, æ˜ç´°: '', é‡‘é¡: 0 },
                    { No: 40, æ˜ç´°: 'â– ã‚¯ãƒ­ã‚¹è²¼æ›¿ãˆã€€å¤©äº•ãƒ»å£ã€€ã€€ãƒˆã‚¤ãƒ¬ã€åç´å«ã‚€ã€€90ã¡Ã—550ï¼49,500', é‡‘é¡: 49500 },
                    { No: 50, æ˜ç´°: 'â– ãƒ•ã‚£ãƒ«ãƒ æ–½å·¥ï¼ç„é–¢ãƒ‰ã‚¢å†…å´', é‡‘é¡: 0 },
                    { No: 60, æ˜ç´°: 'å‚˜ç«‹ã¦æ’¤å»ã€ãƒ‘ãƒ†å«ã‚€ã€€ã€€ï¼Šãƒ‰ã‚¢ãƒã‚¹ãƒˆã¯å¡—è£…æ¸ˆã¿ã§ã™ã€€12,000', é‡‘é¡: 12000 },
                    { No: 70, æ˜ç´°: 'äº¤é€šè²»ã€€8,000', é‡‘é¡: 8000 }
                ]
            },
            {
                ç™ºæ³¨æ—¥ä»˜: '2025/06/19',
                ä¼ç¥¨ç•ªå·: '267839',
                ç™ºæ³¨å…ˆå: '(æ ª)å°è…ç¡å­ã€€çœŸç ‚',
                å·¥äº‹å ´æ‰€: 'æ±Ÿæ±åŒºæ°¸ä»£1-2-7',
                å—æ³¨å…ˆ: 'èˆˆå’Œç®¡ç†(æ ª)',
                ç‰©ä»¶å: 'æ—¥èˆˆãƒ‘ãƒ¬ã‚¹æ°¸ä»£ã€€803å·å®¤ã€€ï½»ï½¯ï½¼ä¸å…·åˆè£œä¿®',
                æ‹…å½“è€…: 'è—¤å²¡',
                æ–½å·¥é–‹å§‹æ—¥: '2025/6/28',
                æ–½å·¥çµ‚äº†æ—¥: '2025/06/28',
                ã‚«ã‚®: 'å…¥å±…è€…ï¼šå²¡æœ¬ã€€è‰ã€…å­ï¼ˆã‚ªã‚«ãƒ¢ãƒˆã€€ãƒªãƒªã‚³ï¼‰æ§˜ã€€090-4178-6170',
                ç™ºæ³¨é‡‘é¡: 21000,
                è©³ç´°æ˜ç´°: [
                    { No: 10, æ˜ç´°: 'ã‚µãƒƒã‚·ä¸å…·åˆè£œä¿®ä½œæ¥­', é‡‘é¡: 18000 },
                    { No: 20, æ˜ç´°: 'äº¤é€šè²»', é‡‘é¡: 3000 }
                ]
            },
            {
                ç™ºæ³¨æ—¥ä»˜: '2025/06/19',
                ä¼ç¥¨ç•ªå·: '267837',
                ç™ºæ³¨å…ˆå: 'å‰å·è¨­å‚™',
                å·¥äº‹å ´æ‰€: 'æ¿æ©‹åŒºä¸Šæ¿æ©‹3-8-3',
                å—æ³¨å…ˆ: '(æ ª)ã‚¦ã‚£ãƒ³ã‚°ã‚¹ã‚¸ãƒ£ãƒ‘ãƒ³',
                ç‰©ä»¶å: 'ãƒ”ã‚¢ãƒã‚¦ã‚¹201',
                æ‹…å½“è€…: 'è—¤å²¡',
                æ–½å·¥é–‹å§‹æ—¥: '2025/7/5',
                æ–½å·¥çµ‚äº†æ—¥: '2025/07/05',
                ã‚«ã‚®: 'å…¥å±…ä¸­',
                ç™ºæ³¨é‡‘é¡: 25000,
                è©³ç´°æ˜ç´°: [
                    { No: 10, æ˜ç´°: 'è¨­å‚™å·¥äº‹ä¸€å¼', é‡‘é¡: 22000 },
                    { No: 20, æ˜ç´°: 'äº¤é€šè²»ãƒ»è«¸çµŒè²»', é‡‘é¡: 3000 }
                ]
            },
            {
                ç™ºæ³¨æ—¥ä»˜: '2025/06/13',
                ä¼ç¥¨ç•ªå·: '267499',
                ç™ºæ³¨å…ˆå: 'ã‚¤ãƒ³ãƒ†ãƒªã‚¢ãƒŠã‚¬ã‚¤ã€€æ°¸äº•è‹±ä»',
                å·¥äº‹å ´æ‰€: 'æ¸‹è°·åŒºä»£ã€…æœ¨5-39-2',
                å—æ³¨å…ˆ: 'èˆˆå’Œç®¡ç†(æ ª)',
                ç‰©ä»¶å: 'ãƒ‘ãƒ¬ã‚¹ä»£ã€…æœ¨ã€€201å·å®¤',
                æ‹…å½“è€…: 'è—¤å²¡',
                æ–½å·¥é–‹å§‹æ—¥: '2025/7/3',
                æ–½å·¥çµ‚äº†æ—¥: '2025/07/04',
                ã‚«ã‚®: 'ç„é–¢å—äº¬éŒ ï¼š5058',
                ç™ºæ³¨é‡‘é¡: 69500,
                è©³ç´°æ˜ç´°: [
                    { No: 10, æ˜ç´°: 'ä»¥ä¸‹ã€ç™ºæ³¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚', é‡‘é¡: 0 },
                    { No: 20, æ˜ç´°: 'ææ–™ç¾å ´ç´å“ã€€ã‚´ãƒŸã¯ãƒ‹ãƒƒã‚½ã‚¦ã¸', é‡‘é¡: 0 },
                    { No: 30, æ˜ç´°: '', é‡‘é¡: 0 },
                    { No: 40, æ˜ç´°: 'â– ã‚¯ãƒ­ã‚¹è²¼æ›¿ãˆã€€å¤©äº•ãƒ»å£ã€€ã€€ãƒˆã‚¤ãƒ¬ã€åç´å«ã‚€ã€€90ã¡Ã—550ï¼49,500', é‡‘é¡: 49500 },
                    { No: 50, æ˜ç´°: 'â– ãƒ•ã‚£ãƒ«ãƒ æ–½å·¥ï¼ç„é–¢ãƒ‰ã‚¢å†…å´', é‡‘é¡: 0 },
                    { No: 60, æ˜ç´°: 'å‚˜ç«‹ã¦æ’¤å»ã€ãƒ‘ãƒ†å«ã‚€ã€€ã€€ï¼Šãƒ‰ã‚¢ãƒã‚¹ãƒˆã¯å¡—è£…æ¸ˆã¿ã§ã™ã€€12,000', é‡‘é¡: 12000 },
                    { No: 70, æ˜ç´°: 'äº¤é€šè²»ã€€8,000', é‡‘é¡: 8000 }
                ]
            }
        ];

        // ææ–™ç™ºæ³¨æ›¸
        this.materialOrders = [
            {
                ID: 1,
                ç‰©ä»¶No: '37.04.001',
                ç™ºæ³¨æ—¥: new Date('2024-03-10'),
                ä»•å…¥ã‚Œå…ˆ: 'ãƒ‘ãƒŠã‚½ãƒ‹ãƒƒã‚¯ä½å»º',
                å“ç›®: 'ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒƒãƒãƒ³',
                å‹ç•ª: 'Lacucina',
                ç™ºæ³¨é‡‘é¡: 785000,
                ç´æœŸ: new Date('2024-03-25'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç´å“æ¸ˆã¿'
            },
            {
                ID: 2,
                ç‰©ä»¶No: '37.04.001',
                ç™ºæ³¨æ—¥: new Date('2024-03-12'),
                ä»•å…¥ã‚Œå…ˆ: 'TOTOè²©å£²åº—',
                å“ç›®: 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹',
                å‹ç•ª: 'WBV1616',
                ç™ºæ³¨é‡‘é¡: 648000,
                ç´æœŸ: new Date('2024-03-28'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç´å“æ¸ˆã¿'
            },
            // ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ã®ææ–™ç™ºæ³¨è¿½åŠ 
            {
                ID: 3,
                ç‰©ä»¶No: '37.04.001',
                ç™ºæ³¨æ—¥: new Date('2024-04-05'),
                ä»•å…¥ã‚Œå…ˆ: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                å“ç›®: 'ã‚­ãƒƒãƒãƒ³éƒ¨æ',
                å‹ç•ª: 'KT-Premium',
                ç™ºæ³¨é‡‘é¡: 920000,
                ç´æœŸ: new Date('2024-04-20'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç´å“æ¸ˆã¿'
            },
            {
                ID: 4,
                ç‰©ä»¶No: '37.04.002',
                ç™ºæ³¨æ—¥: new Date('2024-04-10'),
                ä»•å…¥ã‚Œå…ˆ: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                å“ç›®: 'æ°´å»»ã‚Š4ç‚¹ã‚»ãƒƒãƒˆ',
                å‹ç•ª: 'WS-STANDARD',
                ç™ºæ³¨é‡‘é¡: 600000,
                ç´æœŸ: new Date('2024-04-25'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç´å“æ¸ˆã¿'
            },
            {
                ID: 5,
                ç‰©ä»¶No: '37.04.003',
                ç™ºæ³¨æ—¥: new Date('2024-04-15'),
                ä»•å…¥ã‚Œå…ˆ: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                å“ç›®: 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹',
                å‹ç•ª: 'UB-1616',
                ç™ºæ³¨é‡‘é¡: 580000,
                ç´æœŸ: new Date('2024-04-30'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç´å“æ¸ˆã¿'
            }
        ];

        // ææ–™å±‹ã‹ã‚‰ã®è«‹æ±‚ãƒ‡ãƒ¼ã‚¿ï¼ˆè¤‡æ•°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰
        this.supplierInvoices = [
            {
                ID: 1,
                ç‰©ä»¶No: '37.04.001',
                ä»•å…¥ã‚Œå…ˆ: 'ãƒ‘ãƒŠã‚½ãƒ‹ãƒƒã‚¯ä½å»º',
                è«‹æ±‚æ—¥: new Date('2024-03-30'),
                è«‹æ±‚ç•ªå·: 'PAN-2024-0330-001',
                ãƒ‡ãƒ¼ã‚¿å½¢å¼: 'PDF',
                å“ç›®: 'ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒƒãƒãƒ³',
                å‹ç•ª: 'Lacucina',
                è«‹æ±‚é‡‘é¡: 785000,
                æ¶ˆè²»ç¨: 78500,
                åˆè¨ˆé‡‘é¡: 863500,
                æ”¯æ‰•æœŸé™: new Date('2024-04-30'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'æ”¯æ‰•æ¸ˆã¿'
            },
            // ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿéš›ã®è«‹æ±‚ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
            {
                ID: 2,
                ç‰©ä»¶No: '37.04.001',
                ä»•å…¥ã‚Œå…ˆ: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                è«‹æ±‚æ—¥: new Date('2024-04-15'),
                è«‹æ±‚ç•ªå·: 'TOSHIN-2024-04-001',
                ãƒ‡ãƒ¼ã‚¿å½¢å¼: 'CSV',
                å“ç›®: 'ã‚­ãƒƒãƒãƒ³éƒ¨æ',
                å‹ç•ª: 'KT-Premium',
                è«‹æ±‚é‡‘é¡: 920000,
                æ¶ˆè²»ç¨: 92000,
                åˆè¨ˆé‡‘é¡: 1012000,
                æ”¯æ‰•æœŸé™: new Date('2024-05-15'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'æ”¯æ‰•æ¸ˆã¿',
                å‚™è€ƒ: 'ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä»•æ§˜'
            },
            {
                ID: 3,
                ç‰©ä»¶No: '37.04.002',
                ä»•å…¥ã‚Œå…ˆ: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                è«‹æ±‚æ—¥: new Date('2024-04-20'),
                è«‹æ±‚ç•ªå·: 'TOSHIN-2024-04-002',
                ãƒ‡ãƒ¼ã‚¿å½¢å¼: 'CSV',
                å“ç›®: 'æ°´å»»ã‚Š4ç‚¹ã‚»ãƒƒãƒˆ',
                å‹ç•ª: 'WS-STANDARD',
                è«‹æ±‚é‡‘é¡: 600000,
                æ¶ˆè²»ç¨: 60000,
                åˆè¨ˆé‡‘é¡: 660000,
                æ”¯æ‰•æœŸé™: new Date('2024-05-20'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'æ”¯æ‰•æ¸ˆã¿',
                å‚™è€ƒ: 'åŸçŠ¶å›å¾©ç”¨æ¨™æº–ä»•æ§˜'
            },
            {
                ID: 4,
                ç‰©ä»¶No: '37.04.003',
                ä»•å…¥ã‚Œå…ˆ: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                è«‹æ±‚æ—¥: new Date('2024-04-25'),
                è«‹æ±‚ç•ªå·: 'TOSHIN-2024-04-003',
                ãƒ‡ãƒ¼ã‚¿å½¢å¼: 'CSV',
                å“ç›®: 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹',
                å‹ç•ª: 'UB-1616',
                è«‹æ±‚é‡‘é¡: 580000,
                æ¶ˆè²»ç¨: 58000,
                åˆè¨ˆé‡‘é¡: 638000,
                æ”¯æ‰•æœŸé™: new Date('2024-05-25'),
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'ç…§åˆå¾…ã¡',
                å‚™è€ƒ: 'ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç”¨1616ã‚µã‚¤ã‚º'
            },
            // ææ–™å±‹è«‹æ±‚æ˜ç´°ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
            {
                è«‹æ±‚æ›¸ç•ªå·: 'TC-2025-0615-001',
                ææ–™å±‹å: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                è«‹æ±‚æ—¥: '2025/06/15',
                ç‰©ä»¶å: 'ãƒ‘ãƒ¬ã‚¹ä»£ã€…æœ¨ã€€201å·å®¤',
                æ˜ç´°: [
                    { å•†å“å: 'ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒƒãƒãƒ³ IHå¯¾å¿œ', å‹ç•ª: 'TC-KIT-001', æ•°é‡: 1, å˜ä¾¡: 85000, é‡‘é¡: 85000 },
                    { å•†å“å: 'æ´—é¢åŒ–ç²§å°', å‹ç•ª: 'TC-WB-205', æ•°é‡: 1, å˜ä¾¡: 32000, é‡‘é¡: 32000 },
                    { å•†å“å: 'é…é€è²»', å‹ç•ª: '', æ•°é‡: 1, å˜ä¾¡: 8000, é‡‘é¡: 8000 }
                ],
                åˆè¨ˆé‡‘é¡: 125000,
                æ”¯æ‰•æœŸé™: '2025/07/15',
                ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: 'CSV'
            },
            {
                è«‹æ±‚æ›¸ç•ªå·: 'PH-2025-0618-003',
                ææ–™å±‹å: 'ãƒ‘ãƒŠã‚½ãƒ‹ãƒƒã‚¯ä½å»º',
                è«‹æ±‚æ—¥: '2025/06/18',
                ç‰©ä»¶å: 'ã‚µãƒ³ã‚¢ã‚»ãƒ³ãƒˆã€€301å·å®¤',
                æ˜ç´°: [
                    { å•†å“å: 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹ 1216ã‚µã‚¤ã‚º', å‹ç•ª: 'PH-UB-1216', æ•°é‡: 1, å˜ä¾¡: 95000, é‡‘é¡: 95000 },
                    { å•†å“å: 'æµ´å®¤æ›æ°—æ‰‡', å‹ç•ª: 'PH-FAN-24', æ•°é‡: 1, å˜ä¾¡: 15000, é‡‘é¡: 15000 },
                    { å•†å“å: 'è¨­ç½®å·¥äº‹è²»', å‹ç•ª: '', æ•°é‡: 1, å˜ä¾¡: 25000, é‡‘é¡: 25000 }
                ],
                åˆè¨ˆé‡‘é¡: 135000,
                æ”¯æ‰•æœŸé™: '2025/07/18',
                ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: 'PDF'
            },
            {
                è«‹æ±‚æ›¸ç•ªå·: 'TT-2025-0620-007',
                ææ–™å±‹å: 'TOTOè²©å£²åº—',
                è«‹æ±‚æ—¥: '2025/06/20',
                ç‰©ä»¶å: 'ä¸­å¤–åŒ»å­¦ç¤¾ã€€å¥³å­ãƒˆã‚¤ãƒ¬',
                æ˜ç´°: [
                    { å•†å“å: 'æ´‹å¼ä¾¿å™¨ã‚»ãƒƒãƒˆ', å‹ç•ª: 'TT-WC-CS230B', æ•°é‡: 2, å˜ä¾¡: 28000, é‡‘é¡: 56000 },
                    { å•†å“å: 'æ‰‹æ´—å™¨', å‹ç•ª: 'TT-HW-LSL870', æ•°é‡: 1, å˜ä¾¡: 18000, é‡‘é¡: 18000 },
                    { å•†å“å: 'é…ç®¡éƒ¨æä¸€å¼', å‹ç•ª: 'TT-PIPE-SET', æ•°é‡: 1, å˜ä¾¡: 12000, é‡‘é¡: 12000 }
                ],
                åˆè¨ˆé‡‘é¡: 86000,
                æ”¯æ‰•æœŸé™: '2025/07/20',
                ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: 'Excel'
            }
        ];

        // ææ–™å±‹ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å«ã‚€ï¼‰
        this.suppliers = [
            {
                ID: 1,
                ä¼šç¤¾å: 'ãƒ‘ãƒŠã‚½ãƒ‹ãƒƒã‚¯ä½å»º',
                é€£çµ¡å…ˆ: '03-1234-5678',
                æ‹…å½“è€…: 'ç”°ä¸­',
                ãƒ¡ãƒ¼ãƒ«: 'tanaka@panasonic-jutaku.co.jp',
                ä¸»è¦å–æ‰±å•†å“: ['ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒƒãƒãƒ³', 'æ´—é¢å°', 'å†…è£…å»ºæ'],
                è«‹æ±‚æ›¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 'PDF',
                æ”¯æ‰•æ¡ä»¶: 'æœˆæœ«ç· ã‚ç¿Œæœˆæœ«æ‰•ã„',
                å‚™è€ƒ: 'å¤§æ‰‹ä½è¨­ãƒ¡ãƒ¼ã‚«ãƒ¼'
            },
            {
                ID: 2,
                ä¼šç¤¾å: 'ãƒˆãƒ¼ã‚·ãƒ³ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',
                é€£çµ¡å…ˆ: '03-9876-5432',
                æ‹…å½“è€…: 'ä½è—¤',
                ãƒ¡ãƒ¼ãƒ«: 'sato@toshin-corp.co.jp',
                ä¸»è¦å–æ‰±å•†å“: ['æ°´å»»ã‚Šè¨­å‚™', 'ã‚­ãƒƒãƒãƒ³éƒ¨æ', 'ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹', 'ãƒ•ãƒ­ãƒ¼ãƒªãƒ³ã‚°'],
                è«‹æ±‚æ›¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 'CSV',
                æ”¯æ‰•æ¡ä»¶: '20æ—¥ç· ã‚ç¿Œæœˆ15æ—¥æ‰•ã„',
                å‚™è€ƒ: 'ä¸­å …ææ–™å±‹ãƒ»CSVå½¢å¼ã®è©³ç´°æ˜ç´°æä¾›'
            },
            {
                ID: 3,
                ä¼šç¤¾å: 'TOTOè²©å£²åº—',
                é€£çµ¡å…ˆ: '03-5555-1111',
                æ‹…å½“è€…: 'å±±ç”°',
                ãƒ¡ãƒ¼ãƒ«: 'yamada@toto-dealer.co.jp',
                ä¸»è¦å–æ‰±å•†å“: ['ãƒ¦ãƒ‹ãƒƒãƒˆãƒã‚¹', 'ãƒˆã‚¤ãƒ¬', 'æ´—é¢å°'],
                è«‹æ±‚æ›¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 'Excel',
                æ”¯æ‰•æ¡ä»¶: 'æœˆæœ«ç· ã‚ç¿Œæœˆæœ«æ‰•ã„',
                å‚™è€ƒ: 'TOTOæ­£è¦ä»£ç†åº—'
            }
        ];

        // å°å£ç²¾ç®—ãƒ‡ãƒ¼ã‚¿
        this.pettyExpenses = [
            {
                ID: 1,
                ç‰©ä»¶No: '37.04.001',
                ç²¾ç®—æ—¥: new Date('2024-03-20'),
                ç²¾ç®—è€…: 'å²¡ç”°',
                å“ç›®: 'è£œä¿®ææ–™',
                è³¼å…¥å…ˆ: 'ãƒ›ãƒ¼ãƒ ã‚»ãƒ³ã‚¿ãƒ¼',
                é‡‘é¡: 15000,
                ãƒ¬ã‚·ãƒ¼ãƒˆæœ‰ç„¡: true,
                å‚™è€ƒ: 'ç·Šæ€¥è£œä¿®ç”¨'
            }
        ];

        // å·¥äº‹è«‹æ±‚æ›¸ï¼ˆè·äººã‹ã‚‰ã®è«‹æ±‚ï¼‰
        this.contractorInvoices = [
            {
                ID: 1,
                ç‰©ä»¶No: '37.04.001',
                è«‹æ±‚æ—¥: new Date('2024-04-20'),
                æ¥­è€…å: 'å†…è£…å·¥äº‹æ ªå¼ä¼šç¤¾',
                å·¥äº‹å†…å®¹: 'å†…è£…å·¥äº‹ä¸€å¼',
                è«‹æ±‚é‡‘é¡: 520000,
                æ¶ˆè²»ç¨: 52000,
                åˆè¨ˆé‡‘é¡: 572000,
                ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 'æ¥­è€…ç‹¬è‡ª',
                ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'æ”¯æ‰•æ¸ˆã¿',
                å‚™è€ƒ: 'äºˆå®šé€šã‚Šå®Œäº†'
            }
        ];

        // éŠ€è¡Œå…¥é‡‘ãƒ‡ãƒ¼ã‚¿
        this.bankDeposits = [
            {
                ID: 1,
                ç‰©ä»¶No: '37.04.001',
                å…¥é‡‘æ—¥: new Date('2024-05-30'),
                å…¥é‡‘è€…: 'æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«',
                å…¥é‡‘é¡: 5000000,
                æŒ¯è¾¼æ‰‹æ•°æ–™: 330,
                å®Ÿå…¥é‡‘é¡: 4999670,
                å‚™è€ƒ: 'å·¥äº‹ä»£é‡‘',
                ç…§åˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: 'å®Œäº†'
            }
        ];

        // å·¥äº‹æ¥­è€…ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
        this.contractors = [
            {
                æ¥­è€…å: '(æ ª)ã‚¢ãƒ³ã‚»ã‚¤',
                æ¥­ç¨®: 'ç·åˆå·¥äº‹',
                é€£çµ¡å…ˆ: '03-1234-5678',
                æ‹…å½“è€…: 'å®‰è¥¿',
                å¾—æ„åˆ†é‡: ['å†…è£…å·¥äº‹', 'è¨­å‚™å·¥äº‹'],
                å˜ä¾¡: { ã‚¯ãƒ­ã‚¹è²¼æ›¿: 550, ãƒ•ã‚£ãƒ«ãƒ æ–½å·¥: 300, äº¤é€šè²»: 8000 }
            },
            {
                æ¥­è€…å: '(åŒ)æ‘ä¸Šå¡—è£…',
                æ¥­ç¨®: 'å¡—è£…å·¥äº‹',
                é€£çµ¡å…ˆ: '03-2345-6789',
                æ‹…å½“è€…: 'æ‘ä¸Š',
                å¾—æ„åˆ†é‡: ['å¡—è£…å·¥äº‹', 'ã‚¯ãƒ­ã‚¹å·¥äº‹'],
                å˜ä¾¡: { ã‚¯ãƒ­ã‚¹è²¼æ›¿: 550, å¡—è£…å·¥äº‹: 800, äº¤é€šè²»: 8000 }
            },
            {
                æ¥­è€…å: 'ã‚¤ãƒ³ãƒ†ãƒªã‚¢ãƒŠã‚¬ã‚¤',
                æ¥­ç¨®: 'å†…è£…å·¥äº‹',
                é€£çµ¡å…ˆ: '03-3456-7890',
                æ‹…å½“è€…: 'æ°¸äº•è‹±ä»',
                å¾—æ„åˆ†é‡: ['ã‚¯ãƒ­ã‚¹å·¥äº‹', 'ãƒ•ã‚£ãƒ«ãƒ æ–½å·¥'],
                å˜ä¾¡: { ã‚¯ãƒ­ã‚¹è²¼æ›¿: 550, ãƒ•ã‚£ãƒ«ãƒ æ–½å·¥: 300, äº¤é€šè²»: 8000 }
            },
            {
                æ¥­è€…å: '(æ ª)å°è…ç¡å­',
                æ¥­ç¨®: 'ã‚¬ãƒ©ã‚¹ãƒ»ã‚µãƒƒã‚·å·¥äº‹',
                é€£çµ¡å…ˆ: '03-4567-8901',
                æ‹…å½“è€…: 'å°è…',
                å¾—æ„åˆ†é‡: ['ã‚µãƒƒã‚·å·¥äº‹', 'ã‚¬ãƒ©ã‚¹å·¥äº‹'],
                å˜ä¾¡: { ã‚µãƒƒã‚·è£œä¿®: 15000, äº¤é€šè²»: 3000 }
            },
            {
                æ¥­è€…å: 'å‰å·è¨­å‚™',
                æ¥­ç¨®: 'è¨­å‚™å·¥äº‹',
                é€£çµ¡å…ˆ: '03-5678-9012',
                æ‹…å½“è€…: 'å‰å·',
                å¾—æ„åˆ†é‡: ['çµ¦æ’æ°´å·¥äº‹', 'é›»æ°—å·¥äº‹'],
                å˜ä¾¡: { è¨­å‚™å·¥äº‹: 20000, äº¤é€šè²»: 3000 }
            }
        ];

        // å·¥äº‹æ³¨æ–‡æ›¸ç…§åˆæ©Ÿèƒ½
        this.workOrderVerification = [
            {
                ä¼ç¥¨ç•ªå·: '267499',
                ç…§åˆçµæœ: 'OK',
                è©³ç´°æ˜ç´°åˆè¨ˆ: 69500,
                ç™ºæ³¨é‡‘é¡: 69500,
                å·®ç•°: 0,
                ãƒã‚§ãƒƒã‚¯é …ç›®: [
                    { é …ç›®: 'æ˜ç´°åˆè¨ˆãƒã‚§ãƒƒã‚¯', çµæœ: 'OK', è©³ç´°: '49,500 + 12,000 + 8,000 = 69,500' },
                    { é …ç›®: 'å˜ä¾¡ãƒã‚§ãƒƒã‚¯', çµæœ: 'OK', è©³ç´°: 'ã‚¯ãƒ­ã‚¹è²¼æ›¿ 90ã¡Ã—550å†† = 49,500å††' },
                    { é …ç›®: 'æ¥­è€…ãƒã‚¹ã‚¿ãƒ¼ãƒã‚§ãƒƒã‚¯', çµæœ: 'OK', è©³ç´°: 'ã‚¤ãƒ³ãƒ†ãƒªã‚¢ãƒŠã‚¬ã‚¤ - å†…è£…å·¥äº‹æ¥­è€…ã¨ã—ã¦ç™»éŒ²æ¸ˆã¿' }
                ]
            },
            {
                ä¼ç¥¨ç•ªå·: '267926',
                ç…§åˆçµæœ: 'WARNING',
                è©³ç´°æ˜ç´°åˆè¨ˆ: 69500,
                ç™ºæ³¨é‡‘é¡: 38000,
                å·®ç•°: -31500,
                ãƒã‚§ãƒƒã‚¯é …ç›®: [
                    { é …ç›®: 'æ˜ç´°åˆè¨ˆãƒã‚§ãƒƒã‚¯', çµæœ: 'ERROR', è©³ç´°: '49,500 + 12,000 + 8,000 = 69,500 â‰  38,000' },
                    { é …ç›®: 'å˜ä¾¡ãƒã‚§ãƒƒã‚¯', çµæœ: 'OK', è©³ç´°: 'ã‚¯ãƒ­ã‚¹è²¼æ›¿ 90ã¡Ã—550å†† = 49,500å††' },
                    { é …ç›®: 'æ¥­è€…ãƒã‚¹ã‚¿ãƒ¼ãƒã‚§ãƒƒã‚¯', çµæœ: 'OK', è©³ç´°: 'æ‘ä¸Šå¡—è£… - å¡—è£…å·¥äº‹æ¥­è€…ã¨ã—ã¦ç™»éŒ²æ¸ˆã¿' }
                ]
            }
        ];
    }

    async query(sql, params = []) {
        console.log(`ğŸ” Enhanced Mock DB Query: ${sql}`);
        
        if (sql.includes('æ¡ˆä»¶ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«')) {
            return this.handleProjectQuery(sql, params);
        }
        if (sql.includes('è¦‹ç©ã‚‚ã‚Šãƒ†ãƒ¼ãƒ–ãƒ«')) {
            return this.handleEstimateQuery(sql, params);
        }
        
        return [];
    }

    handleProjectQuery(sql, params) {
        return this.projects;
    }

    handleEstimateQuery(sql, params) {
        let results = [...this.estimates];
        const projectNoMatch = sql.match(/ç‰©ä»¶No = '(.+?)'/);
        if (projectNoMatch) {
            const projectNo = projectNoMatch[1];
            results = results.filter(e => e.ç‰©ä»¶No === projectNo);
        }
        return results;
    }

    // é«˜åº¦ãªç…§åˆãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
    performAdvancedVerification(projectNo = null) {
        const projects = projectNo ? 
            this.projects.filter(p => p.ç‰©ä»¶No === projectNo) : 
            this.projects;

        const verificationResults = [];

        projects.forEach(project => {
            const result = {
                projectNo: project.ç‰©ä»¶No,
                projectName: project.ç‰©ä»¶å,
                checks: {
                    materialEstimateVsOrder: this.checkMaterialEstimateVsOrder(project.ç‰©ä»¶No),
                    materialOrderVsInvoice: this.checkMaterialOrderVsInvoice(project.ç‰©ä»¶No),
                    workEstimateVsOrder: this.checkWorkEstimateVsOrder(project.ç‰©ä»¶No),
                    totalCostVerification: this.checkTotalCostVerification(project.ç‰©ä»¶No),
                    paymentVerification: this.checkPaymentVerification(project.ç‰©ä»¶No)
                }
            };

            verificationResults.push(result);
        });

        return verificationResults;
    }

    // 1. å·¥äº‹ç™ºæ³¨æ›¸ã®é‡‘é¡ã¨è¦‹ç©ã‚‚ã‚Šæ›¸ã®åŸä¾¡ç…§åˆ
    checkWorkEstimateVsOrder(projectNo) {
        const estimates = this.estimates.filter(e => 
            e.ç‰©ä»¶No === projectNo && e.ã‚«ãƒ†ã‚´ãƒª === 'å·¥äº‹'
        );
        const workOrders = this.workOrders.filter(w => w.ç‰©ä»¶å === projectNo);

        const results = [];
        
        estimates.forEach(estimate => {
            const matchingOrder = workOrders.find(order => 
                order.å·¥äº‹å†…å®¹.includes(estimate.å“ç›®)
            );

            if (matchingOrder) {
                const difference = Math.abs(estimate.è¦‹ç©åŸä¾¡ - matchingOrder.ç™ºæ³¨é‡‘é¡);
                const diffPercent = (difference / estimate.è¦‹ç©åŸä¾¡) * 100;

                results.push({
                    type: diffPercent < 5 ? 'ok' : diffPercent < 10 ? 'warning' : 'error',
                    item: estimate.å“ç›®,
                    estimateAmount: estimate.è¦‹ç©åŸä¾¡,
                    orderAmount: matchingOrder.ç™ºæ³¨é‡‘é¡,
                    difference: difference,
                    diffPercent: diffPercent.toFixed(1),
                    message: `è¦‹ç©åŸä¾¡ ${estimate.è¦‹ç©åŸä¾¡.toLocaleString()}å†† vs ç™ºæ³¨é‡‘é¡ ${matchingOrder.ç™ºæ³¨é‡‘é¡.toLocaleString()}å††`
                });
            } else {
                results.push({
                    type: 'error',
                    item: estimate.å“ç›®,
                    estimateAmount: estimate.è¦‹ç©åŸä¾¡,
                    orderAmount: 0,
                    message: 'å¯¾å¿œã™ã‚‹ç™ºæ³¨æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
                });
            }
        });

        return results;
    }

    // 2. ææ–™ã®è¦‹ç©ã‚‚ã‚ŠåŸä¾¡ã¨ææ–™å±‹ã‹ã‚‰ã®è«‹æ±‚ãƒ‡ãƒ¼ã‚¿ç…§åˆ
    checkMaterialOrderVsInvoice(projectNo) {
        const materialOrders = this.materialOrders.filter(o => o.ç‰©ä»¶No === projectNo);
        const supplierInvoices = this.supplierInvoices.filter(i => i.ç‰©ä»¶No === projectNo);

        const results = [];

        materialOrders.forEach(order => {
            const matchingInvoice = supplierInvoices.find(invoice => 
                invoice.ä»•å…¥ã‚Œå…ˆ === order.ä»•å…¥ã‚Œå…ˆ && invoice.å‹ç•ª === order.å‹ç•ª
            );

            if (matchingInvoice) {
                const difference = Math.abs(order.ç™ºæ³¨é‡‘é¡ - matchingInvoice.è«‹æ±‚é‡‘é¡);
                const diffPercent = (difference / order.ç™ºæ³¨é‡‘é¡) * 100;

                results.push({
                    type: diffPercent < 2 ? 'ok' : diffPercent < 5 ? 'warning' : 'error',
                    item: order.å“ç›®,
                    supplier: order.ä»•å…¥ã‚Œå…ˆ,
                    orderAmount: order.ç™ºæ³¨é‡‘é¡,
                    invoiceAmount: matchingInvoice.è«‹æ±‚é‡‘é¡,
                    difference: difference,
                    diffPercent: diffPercent.toFixed(1),
                    dataFormat: matchingInvoice.ãƒ‡ãƒ¼ã‚¿å½¢å¼,
                    message: `ç™ºæ³¨ ${order.ç™ºæ³¨é‡‘é¡.toLocaleString()}å†† vs è«‹æ±‚ ${matchingInvoice.è«‹æ±‚é‡‘é¡.toLocaleString()}å†† (${matchingInvoice.ãƒ‡ãƒ¼ã‚¿å½¢å¼})`
                });
            } else {
                results.push({
                    type: 'error',
                    item: order.å“ç›®,
                    supplier: order.ä»•å…¥ã‚Œå…ˆ,
                    orderAmount: order.ç™ºæ³¨é‡‘é¡,
                    invoiceAmount: 0,
                    message: 'å¯¾å¿œã™ã‚‹è«‹æ±‚æ›¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
                });
            }
        });

        return results;
    }

    // 3. ææ–™è¦‹ç©ã‚‚ã‚ŠåŸä¾¡ã¨ææ–™ç™ºæ³¨ç…§åˆ
    checkMaterialEstimateVsOrder(projectNo) {
        const estimates = this.estimates.filter(e => 
            e.ç‰©ä»¶No === projectNo && e.ã‚«ãƒ†ã‚´ãƒª === 'ææ–™'
        );
        const materialOrders = this.materialOrders.filter(o => o.ç‰©ä»¶No === projectNo);

        const results = [];

        estimates.forEach(estimate => {
            const matchingOrder = materialOrders.find(order => 
                order.å‹ç•ª === estimate.å‹ç•ª
            );

            if (matchingOrder) {
                const difference = Math.abs(estimate.è¦‹ç©åŸä¾¡ - matchingOrder.ç™ºæ³¨é‡‘é¡);
                const diffPercent = (difference / estimate.è¦‹ç©åŸä¾¡) * 100;

                results.push({
                    type: diffPercent < 3 ? 'ok' : diffPercent < 8 ? 'warning' : 'error',
                    item: estimate.å“ç›®,
                    modelNo: estimate.å‹ç•ª,
                    estimateAmount: estimate.è¦‹ç©åŸä¾¡,
                    orderAmount: matchingOrder.ç™ºæ³¨é‡‘é¡,
                    difference: difference,
                    diffPercent: diffPercent.toFixed(1),
                    message: `è¦‹ç©åŸä¾¡ ${estimate.è¦‹ç©åŸä¾¡.toLocaleString()}å†† vs ç™ºæ³¨é‡‘é¡ ${matchingOrder.ç™ºæ³¨é‡‘é¡.toLocaleString()}å††`
                });
            } else {
                results.push({
                    type: 'error',
                    item: estimate.å“ç›®,
                    modelNo: estimate.å‹ç•ª,
                    estimateAmount: estimate.è¦‹ç©åŸä¾¡,
                    orderAmount: 0,
                    message: 'å¯¾å¿œã™ã‚‹ææ–™ç™ºæ³¨ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
                });
            }
        });

        return results;
    }

    // 4. ç·åˆåŸä¾¡æ¤œè¨¼
    checkTotalCostVerification(projectNo) {
        const project = this.projects.find(p => p.ç‰©ä»¶No === projectNo);
        const materialOrders = this.materialOrders.filter(o => o.ç‰©ä»¶No === projectNo);
        const workOrders = this.workOrders.filter(w => w.ç‰©ä»¶å === projectNo);
        const pettyExpenses = this.pettyExpenses.filter(p => p.ç‰©ä»¶No === projectNo);

        const totalMaterialCost = materialOrders.reduce((sum, o) => sum + o.ç™ºæ³¨é‡‘é¡, 0);
        const totalWorkCost = workOrders.reduce((sum, w) => sum + w.ç™ºæ³¨é‡‘é¡, 0);
        const totalPettyExpenses = pettyExpenses.reduce((sum, p) => sum + p.é‡‘é¡, 0);
        const actualTotalCost = totalMaterialCost + totalWorkCost + totalPettyExpenses;

        const difference = Math.abs(project.è¦‹ç©åŸä¾¡ - actualTotalCost);
        const diffPercent = (difference / project.è¦‹ç©åŸä¾¡) * 100;

        return {
            type: diffPercent < 5 ? 'ok' : diffPercent < 10 ? 'warning' : 'error',
            estimatedCost: project.è¦‹ç©åŸä¾¡,
            actualCost: actualTotalCost,
            breakdown: {
                materials: totalMaterialCost,
                work: totalWorkCost,
                pettyExpenses: totalPettyExpenses
            },
            difference: difference,
            diffPercent: diffPercent.toFixed(1),
            message: `è¦‹ç©åŸä¾¡ ${project.è¦‹ç©åŸä¾¡.toLocaleString()}å†† vs å®Ÿéš›åŸä¾¡ ${actualTotalCost.toLocaleString()}å††`
        };
    }

    // 5. å…¥é‡‘ç…§åˆ
    checkPaymentVerification(projectNo) {
        const project = this.projects.find(p => p.ç‰©ä»¶No === projectNo);
        const bankDeposit = this.bankDeposits.find(b => b.ç‰©ä»¶No === projectNo);

        if (!bankDeposit || !bankDeposit.å…¥é‡‘æ—¥) {
            return {
                type: 'error',
                expectedAmount: project.è«‹æ±‚é¡,
                receivedAmount: 0,
                message: 'å…¥é‡‘ãŒç¢ºèªã§ãã¾ã›ã‚“'
            };
        }

        const difference = Math.abs(project.è«‹æ±‚é¡ - bankDeposit.å…¥é‡‘é¡);
        const handlingFee = bankDeposit.æŒ¯è¾¼æ‰‹æ•°æ–™;

        return {
            type: difference <= handlingFee ? 'ok' : 'warning',
            expectedAmount: project.è«‹æ±‚é¡,
            receivedAmount: bankDeposit.å…¥é‡‘é¡,
            actualReceived: bankDeposit.å®Ÿå…¥é‡‘é¡,
            handlingFee: handlingFee,
            difference: difference,
            message: `è«‹æ±‚é¡ ${project.è«‹æ±‚é¡.toLocaleString()}å†† vs å…¥é‡‘é¡ ${bankDeposit.å…¥é‡‘é¡.toLocaleString()}å††`
        };
    }

    // ç…§åˆã‚µãƒãƒªãƒ¼ç”Ÿæˆ
    generateVerificationSummary() {
        const allResults = this.performAdvancedVerification();
        
        let totalChecks = 0;
        let okCount = 0;
        let warningCount = 0;
        let errorCount = 0;

        allResults.forEach(result => {
            Object.values(result.checks).forEach(checkCategory => {
                if (Array.isArray(checkCategory)) {
                    checkCategory.forEach(check => {
                        totalChecks++;
                        if (check.type === 'ok') okCount++;
                        else if (check.type === 'warning') warningCount++;
                        else if (check.type === 'error') errorCount++;
                    });
                } else {
                    totalChecks++;
                    if (checkCategory.type === 'ok') okCount++;
                    else if (checkCategory.type === 'warning') warningCount++;
                    else if (checkCategory.type === 'error') errorCount++;
                }
            });
        });

        return {
            totalChecks,
            okCount,
            warningCount,
            errorCount,
            okPercent: ((okCount / totalChecks) * 100).toFixed(1),
            details: allResults
        };
    }
}

module.exports = EnhancedMockDatabase; 